    <!-- ======= Header ======= -->
    {{navbar}}

    <!-- ======= Sidebar ======= -->
    {{sidebar}}
  
    <main id="main" class="main">
  
      <div class="pagetitle">
        <h1>Clientes</h1>
        <nav>
          <ol class="breadcrumb">
            <li class="breadcrumb-item"><a href="{{URL}}">Painel</a></li>
            <li class="breadcrumb-item">Pesquisar Clientes</li>
          </ol>
        </nav>
      </div><!-- End Page Title -->
  
      <section class="section dashboard">
        <div class="row">
  
          <!-- Left side columns -->
          <div class="col-lg-12">
            <div class="row">
              <!-- Recent Sales -->
              <div class="col-12">
                <div class="card recent-sales overflow-auto">
  
                  <div class="filter">
                    <a class="icon" href="#" data-bs-toggle="dropdown"><i class="bi bi-three-dots"></i></a>
                    <ul class="dropdown-menu dropdown-menu-end dropdown-menu-arrow">
                      <li class="dropdown-header text-start">
                        <h6>Filter</h6>
                      </li>
  
                      <li><a class="dropdown-item" href="#">Today</a></li>
                      <li><a class="dropdown-item" href="#">This Month</a></li>
                      <li><a class="dropdown-item" href="#">This Year</a></li>
                    </ul>
                  </div>

                 <!-- Modal -->
                <div class="modal fade" id="clientModal" tabindex="-1" aria-labelledby="clientModalLabel" aria-hidden="true">
                    <div class="modal-dialog modal-lg modal-dialog-centered">
                    <div class="modal-content">
                        <div class="modal-header">
                        <h5 class="modal-title" id="clientModalLabel">Detalhes do Cliente</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <div class="modal-body">

                            <h5 class="card-title">Dados Pessoais</h5>
                            <div class="row">
                              <div class="col-lg-3 col-md-4 label">Numero de Conta:</div>
                              <div class="col-lg-9 col-md-8" id="numero_conta"></div>
                            </div>
                            <div class="row">
                              <div class="col-lg-3 col-md-4 label">Nome Completo:</div>
                              <div class="col-lg-9 col-md-8" id="nome-completo"></div>
                            </div>
                            <div class="row">
                              <div class="col-lg-3 col-md-4 label">Tipo do Documento:</div>
                              <div class="col-lg-9 col-md-8" id="tipo-documento"></div>
                            </div>
                            <div class="row">
                              <div class="col-lg-3 col-md-4 label">Numero do Documento:</div>
                              <div class="col-lg-9 col-md-8" id="doc-number"></div>
                            </div>
                            <div class="row">
                              <div class="col-lg-3 col-md-4 label">Contacto:</div>
                              <div class="col-lg-9 col-md-8" id="contacto"></div>
                            </div>
                            <div class="row">
                              <div class="col-lg-3 col-md-4 label">Contacto Alternativo:</div>
                              <div class="col-lg-9 col-md-8" id="contacto-alt"></div>
                            </div>
                            <div class="row">
                              <div class="col-lg-3 col-md-4 label">Endereco:</div>
                              <div class="col-lg-9 col-md-8" id="endereco"></div>
                            </div>
                            <div class="row">
                              <div class="col-lg-3 col-md-4 label">Email:</div>
                              <div class="col-lg-9 col-md-8" id="email"></div>
                            </div>
                            <div class="row">
                              <div class="col-lg-3 col-md-4 label">Saldo Disponivel:</div>
                              <div class="col-lg-9 col-md-8" id="saldo"></div>
                            </div>
        
        
        
        
                            <h5 class="card-title">Montante e Comprovativo</h5>
                            <form class="row g-3" method="POST" enctype="multipart/form-data">
        
                                <input type="hidden" name="text_codigo_conta" id="hidden_codigo_conta">
                                <input type="hidden" name="text_numero_conta" id="hidden_numero_conta">
                                <input type="hidden" name="text_codigo_cliente" id="hidden_codigo_cliente">
                                <div class="col-md-6">
                                    <label for="inputName5" class="form-label">Montante a Depositar</label>
                                    <input type="number" name="text_montante_deposito" class="form-control" id="inputName5">
                                </div>
                                <div class="col-md-6">
                                    <label for="inputName5" class="form-label">Comprovativo</label>
                                    <input type="file" name="imagem" class="form-control" id="inputName5">
                                    <label for=""><small style="font-size: 11px; color: #6f6f6f;">Anexe um comprovativo (Ex: PDF, Imagem, Screenshot, etc)</small></label>
                                </div>
                          </div>
                        <div class="modal-footer">
                            <div class="text-center" style="width: 100%; display: flex; justify-content: center; align-items: center;">
                                <button type="submit" class="btn btn-primary"><i class="bi bi-floppy"></i> Realizar Deposito</button>
                                <button type="button" style="margin-left: 10px;" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                            </div>
                        </div>
                    </form>
                    </div>
                    </div>
                </div>
  
  

                  <div class="card">
                    <div class="card-body">
                      <h5 class="card-title">Pesquisar Cliente</h5>
                      <div class="header" style="box-shadow: unset; padding: 10px;">
                        <form id="search-form" class="search-form d-flex align-items-center" method="POST" action="#">
                          <input type="text" id="text_client_search" placeholder="Pesquisar pelo nome ou Numero de Conta..." title="Enter search keyword">
                          <button type="submit" title="Search"><i class="bi bi-search"></i></button>
                        </form>
                      </div>
                  
                      <table class="table table-borderless">
                        <thead>
                          <tr>
                            <th scope="col">Codigo</th>
                            <th scope="col">Nº de conta</th>
                            <th scope="col">Nome completo</th>
                            <th scope="col">Contacto</th>
                            <th scope="col">Estado</th>
                            <th scope="col">Saldo</th>
                            <th scope="col">Acções</th>
                          </tr>
                        </thead>
                        <tbody id="clients-table-body">
                          <!-- Aqui serão inseridos os resultados -->
                           {{items}}
                        </tbody>
                      </table>
                    </div>
                  </div>
                  
                </div>
              </div><!-- End Recent Sales -->
            </div>
          </div><!-- End Left side columns -->
  
        </div>
      </section>
  
    </main><!-- End #main -->
  
    <!-- ======= Footer ======= -->
     {{footer}}
    <!-- End Footer -->
  
    {{status}}
  
    <a href="#" class="back-to-top d-flex align-items-center justify-content-center"><i class="bi bi-arrow-up-short"></i></a>


    <script>
      document.addEventListener('DOMContentLoaded', function () {
        // Código de pesquisa
        document.getElementById("search-form").addEventListener("submit", function(event) {
            event.preventDefault(); // Previne o envio do formulário e recarregamento da página
            const query = document.getElementById("text_client_search").value.toLowerCase(); // Obtém o valor da pesquisa
            showSuggestions(query);
        });
    
        function showSuggestions(query) {
            const suggestionsList = document.getElementById("clients-table-body");
            suggestionsList.innerHTML = ''; // Limpa a tabela
    
            if (query.length === 0) {
                return; // Se o campo de pesquisa estiver vazio, não exibe sugestões
            }
    
            fetch("http://127.0.0.1:8888/fintech/api/clientes?search=" + query)
                .then(response => response.json())
                .then(data => {
                    const filteredClients = data.filter(client =>
                        client.name.toLowerCase().includes(query)
                    );
    
                    if (filteredClients.length > 0) {
                        filteredClients.forEach(client => {
                            const tr = document.createElement("tr");
    
                            tr.innerHTML = `
                                <th scope="row">#${client.id}</th>
                                <td>${client.numero_conta}</td>
                                <td>${client.name}</td>
                                <td><a href="#" class="text-primary">${client.celular}</a></td>
                                <td><span class="badge bg-success">${client.estado}</span></td>
                                <td>${client.saldo}</td>
                                <td>
                                    <div class="dropdown">
                                        <button type="button" style="font-size: 13px;" class="btn btn-info btn-sm dropdown-toggle" id="dropdownMenuButton" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi bi-info-circle" style="font-size: 11px; padding-right: 3px"></i> Acções</button>
                                        <ul class="dropdown-menu" aria-labelledby="dropdownMenuButton">
                                            <li><button class="dropdown-item depositarBtn" data-client='${JSON.stringify(client)}'>Depositar</button></li>
                                            <li><a class="dropdown-item" href="#">Editar</a></li>
                                            <li><a class="dropdown-item" href="#">Revogar</a></li>
                                        </ul>
                                    </div>
                                </td>
                            `;
    
                            suggestionsList.appendChild(tr);
                        });
                    } else {
                        const tr = document.createElement("tr");
                        tr.innerHTML = '<td colspan="7" class="text-center">Nenhum cliente encontrado</td>';
                        suggestionsList.appendChild(tr);
                    }
                })
                .catch(error => {
                    console.error('Erro ao buscar dados da API:', error);
                });
        }
    
        // Usando delegação de eventos para os botões "Depositar"
        document.getElementById('clients-table-body').addEventListener('click', function(event) {
            if (event.target && event.target.classList.contains('depositarBtn')) {
              // Obter o objeto client como string do atributo 'data-client'
              const clientString = event.target.getAttribute('data-client');
              // Converter a string JSON de volta para um objeto
              const client = JSON.parse(clientString);
              // Passando o objecto cliente para a funcao
              abrirModalDepositar(client);
            }
        });
    
        function abrirModalDepositar(client) {
            // Preenche o modal com as informações do cliente
            document.getElementById("nome-completo").textContent = client.name;
            document.getElementById("tipo-documento").textContent = client.tipo_doc;
            document.getElementById("doc-number").textContent = client.documento;
            document.getElementById("contacto").textContent = client.celular;
            document.getElementById("contacto-alt").textContent = client.celular_alt;
            document.getElementById("endereco").textContent = client.endereco;
            document.getElementById("email").textContent = client.email;
            document.getElementById("numero_conta").textContent = client.numero_conta;
            document.getElementById("saldo").textContent = client.saldo + ' MZN';

            // Preenche os campos hidden
            document.getElementById("hidden_codigo_conta").value = client.codigo_conta;  // Preenche o código da conta
            document.getElementById("hidden_numero_conta").value = client.numero_conta  // Preenche o número da conta
            document.getElementById("hidden_codigo_cliente").value = client.id;  // Preenche o código do cliente

            var myModal = new bootstrap.Modal(document.getElementById('clientModal'));
            myModal.show();  // Mostrar o modal
        }
      });
    </script>
    



